# マインドマップ編集機能ガイド

## 概要
このガイドでは、マインドマップのノード（テキストボックス）を追加・編集・削除する方法を説明します。

## 1. 右クリックメニュー

ノードを右クリックすると、以下のメニューが表示されます：

| アイコン | 機能 | 説明 |
|---------|------|------|
| 📋 | 詳細を表示 | 画像、URL、追加データを確認 |
| ➕ | 子ノードを追加 | 新しい子ノードを作成 |
| ✏️ | テキストを編集 | タイトルのみを素早く編集（ダブルクリックと同じ） |
| ⚙️ | ノードを編集 | タイプやステータスも含めて詳細編集 |
| 🗑️ | ノードを削除 | ノードとその子要素を削除 |
| 📁/📂 | 展開/折りたたみ | 子ノードの表示/非表示 |
| 🎯 | フォーカス | 該当ノードを中心に表示 |
| 👤/✅ | 自分の担当にする/外す | 対策系ノードのみ表示 |

## 2. ノードの追加

### 手順
1. 親となるノードを右クリック
2. 「➕ 子ノードを追加」を選択
3. ダイアログで以下を入力：
   - **タイトル**（必須）
   - **タイプ**（推奨タイプが上部に表示）
   - **説明**（任意）
4. 「追加」ボタンをクリック

### 推奨される階層構造
- 中心テーマ → 主要課題
- 主要課題 → 課題
- 課題 → 対策
- 対策 → 現在の取り組み / 将来的な取り組み
- 現在の取り組み → 成功事例

## 3. ノードの編集

### 簡易編集（タイトルのみ）
- **方法1**: ノードをダブルクリック
- **方法2**: 右クリック → 「✏️ テキストを編集」
- **保存**: Ctrl+Enterで保存
- **キャンセル**: Escapeでキャンセル
- **改行**: Enterキーで改行可能（複数行対応）
- テキストエリアは自動的に内容に合わせて高さが調整されます

### 詳細編集（タイプ変更など）
1. ノードを右クリック
2. 「⚙️ ノードを編集」を選択
3. 編集ダイアログで変更：
   - **タイトル**: ノードの表示名
   - **タイプ**: ノードの種類（色が変わります）
   - **説明**: 詳細説明文
   - **ステータス**: 
     - 主要課題・課題：重要、対応中、解決済み
     - 対策系ノード：計画中、実施中、完了
   - **担当者**（対策系ノードのみ）：
     - 未設定または「自分」を選択
     - 「自分」を選択すると進捗状況も設定可能
4. 「更新」ボタンをクリック

### タイプ変更の例
「将来的な取り組み」を「現在の取り組み」に変更：
1. 該当ノードを右クリック → 「⚙️ ノードを編集」
2. タイプを「将来的な取り組み」から「現在の取り組み」に変更
3. 必要に応じてステータスを「実施中」に設定
4. 「更新」をクリック

## 4. ノードの削除

### 手順
1. 削除したいノードを右クリック
2. 「🗑️ ノードを削除」を選択
3. 確認ダイアログで「OK」をクリック

### 注意事項
- 子ノードがある場合、すべての子ノードも削除されます
- ルートノード（中心テーマ）は削除できません
- 削除操作は取り消しできません（事前にエクスポートを推奨）

## 5. データの保存と復元

### エクスポート（保存）
1. ヘッダーの「⬇️」ボタンをクリック
2. JSONファイルがダウンロードされます
3. ファイル名: `kotohira-mindmap-YYYYMMDD-HHMM.json`

### インポート（復元）
1. ヘッダーの「⬆️」ボタンをクリック
2. 保存したJSONファイルを選択
3. 確認ダイアログで「OK」をクリック

## 6. ショートカット

| 操作 | ショートカット |
|------|---------------|
| 検索 | Ctrl/Cmd + F |
| ズームリセット | Ctrl/Cmd + 0 |
| パネルを閉じる | Escape |

## 7. ベストプラクティス

1. **定期的なバックアップ**
   - 大きな変更前にエクスポート
   - 日付別にファイルを保存

2. **階層構造の維持**
   - 推奨される親子関係に従う
   - 深すぎる階層は避ける（6階層程度まで）

3. **タイプの使い分け**
   - 課題系: major_issue, issue
   - 解決系: solution, current_effort, future_effort
   - 成果系: success

4. **ステータスの活用**
   - active: 現在進行中
   - planned: 計画段階
   - completed: 完了済み
   - critical: 重要・緊急

## 8. 自動保存機能

### 概要
- 自動保存機能は**デフォルトで無効**になっています
- 有効にすると、30秒ごとに変更内容が自動保存されます
- ページを更新しても編集内容が保持されます

### 自動保存の有効化
1. ヘッダーの保存アイコン（ディスクマーク）をクリック
2. 「自動保存を有効にしました」のメッセージが表示されます
3. 以降、編集内容は自動的に保存されます

### 自動保存の動作
1. **通常の動作**
   - 編集内容は自動的に保存され、次回アクセス時に自動的に復元されます
   - 24時間以内の自動保存データは確認なしで読み込まれます

2. **古いデータの復元**
   - 24時間以上経過したデータの場合、復元するか確認ダイアログが表示されます
   - キャンセルした場合、古いデータは削除され、初期データが読み込まれます

### 自動保存インジケーター
- 💾 自動保存有効: 通常の状態
- ⏳ 保存中...: データを保存している状態
- ✅ 保存済み: 保存が完了した状態
- ❌ 保存エラー: 保存に失敗した状態
- 🚫 自動保存無効: 機能が無効化されている状態（デフォルト）

### 自動保存の管理
1. **有効/無効の切り替え**
   - ヘッダーの保存アイコン（ディスクマーク）をクリック
   
2. **手動保存**
   - エクスポート機能（⬇️）を使用してJSONファイルとして保存

3. **自動保存データの削除**
   - ゴミ箱アイコン（🗑️）をクリックして自動保存データを削除

### 注意事項
- ブラウザのプライベートモードでは自動保存は機能しません
- ブラウザのストレージ容量には制限があります
- 重要なデータは定期的にエクスポートしてバックアップを取ることを推奨します
- データ構造の不整合により自動保存が無効になった場合があります

## 9. 担当者機能

### 概要
対策系ノード（対策、現在の取り組み、将来的な取り組み、成功事例）では、自分が担当するタスクを視覚的に管理できます。

### 担当者の設定方法
1. **右クリックメニューから**
   - 対策系ノードを右クリック
   - 「👤 自分の担当にする」を選択
   - 自動的に「計画中」として設定されます

2. **ノード編集ダイアログから**
   - 「⚙️ ノードを編集」を選択
   - 担当者を「自分」に設定
   - 進捗状況を選択（計画中、実施中、完了）

### 視覚的な識別
担当ノードは以下のように表示されます：

| 進捗状況 | 視覚効果 | アイコン |
|---------|---------|---------|
| 実施中 | 金色の強調枠とドロップシャドウ | 🌟 |
| 計画中 | 点線の枠 | 📅 |
| 完了 | 透明度を下げて表示 | ✅ |

### 注意事項
- 主要課題や課題には担当者を設定できません
- 担当者機能は対策の実行管理を目的としています
- ステータスと進捗状況は連動して管理されます

## 10. トラブルシューティング

### ノードが編集できない
- ダブルクリックが反応しない → 右クリックメニューを使用
- 編集後に反映されない → ブラウザをリロード

### データが消えた
- 自動保存データから復元（ページ読み込み時に確認）
- バックアップファイルからインポート

### 表示がおかしい
- Ctrl/Cmd + 0 でズームリセット
- ブラウザを再起動

### 自動保存が機能しない
- ブラウザのストレージが満杯 → 不要なデータを削除
- プライベートモード → 通常モードで使用
- ブラウザが対応していない → 最新のブラウザに更新