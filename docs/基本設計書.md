# 琴平町地域活性化マインドマップ - 基本設計書

## 1. システム概要

### 1.1 目的
琴平町の地域活性化に関する課題、対策、成功事例などの情報を視覚的に整理し、関係者間での情報共有と理解促進を支援するインタラクティブなマインドマップWebアプリケーション。

### 1.2 主要機能
- 階層構造データの視覚化
- ノードの展開/折りたたみ
- 詳細情報の表示
- 検索・フィルター機能
- テキスト編集機能
- ズーム・パン操作
- レスポンシブデザイン

### 1.3 技術スタック
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6 Modules)
- **ビジュアライゼーション**: D3.js v7
- **データ形式**: JSON
- **ブラウザサポート**: モダンブラウザ（Chrome, Firefox, Safari, Edge）

## 2. システムアーキテクチャ

### 2.1 全体構成
```
琴平町マインドマップ
├── index.html          # メインHTML
├── css/
│   ├── style.css       # メインスタイル
│   ├── responsive.css  # レスポンシブ対応
│   └── components.css  # コンポーネントスタイル
├── js/
│   ├── main.js         # エントリーポイント
│   ├── mindmap.js      # マインドマップ描画
│   ├── data.js         # データ管理
│   ├── ui.js           # UI制御
│   └── utils.js        # ユーティリティ
├── data/
│   └── kotohira-data.json  # マインドマップデータ
└── docs/
    ├── 基本設計書.md
    ├── 詳細設計書.md
    └── 開発日記.md
```

### 2.2 モジュール構成

#### 2.2.1 main.js (エントリーポイント)
- アプリケーション初期化
- モジュール間の連携設定
- エラーハンドリング

#### 2.2.2 mindmap.js (ビジュアライゼーション)
- D3.jsを使用したマインドマップ描画
- ノードとリンクのレンダリング
- インタラクション処理

#### 2.2.3 data.js (データ管理)
- JSONデータの読み込みと処理
- データ構造の管理
- 検索・フィルター機能

#### 2.2.4 ui.js (UI制御)
- ユーザーインターフェース管理
- イベントハンドリング
- 情報パネルの表示制御

#### 2.2.5 utils.js (ユーティリティ)
- 共通関数
- ヘルパー機能

## 3. データ構造

### 3.1 ノードタイプ
- **root**: 中心テーマ（紫）
- **major_issue**: 主要課題（赤）
- **issue**: 課題（オレンジ）
- **solution**: 対策（青）
- **current_effort**: 現在の取り組み（青緑）
- **success**: 成功事例（緑）

### 3.2 ノード構造
```json
{
  "id": "unique_id",
  "title": "ノードタイトル",
  "type": "node_type",
  "description": "詳細説明",
  "urls": [
    {
      "label": "リンクラベル",
      "url": "https://example.com",
      "description": "リンクの説明"
    }
  ],
  "children": [],
  "data": {
    "追加情報": "値"
  }
}
```

### 3.3 データ階層
1. 中心テーマ（琴平町地域活性化）
2. 主要課題（5つ）
3. 詳細課題
4. 対策・現在の取り組み
5. 成功事例
6. 関連情報（URLリスト）

## 4. ユーザーインターフェース

### 4.1 レイアウト
- **ヘッダー**: タイトル、検索、フィルター、コントロール
- **メインエリア**: マインドマップ表示領域
- **情報パネル**: 詳細情報表示（右サイドバー）
- **フッター**: 凡例、操作説明

### 4.2 インタラクション
- **クリック**: ノードの展開/折りたたみ
- **右クリック**: 詳細情報表示（画像、URL、データのみ）
- **ダブルクリック**: テキスト編集
- **ドラッグ**: マップの移動
- **マウスホイール**: ズーム操作
- **ホバー**: ツールチップ表示

### 4.3 レスポンシブ対応
- タブレット・スマートフォン対応
- タッチ操作サポート
- 画面サイズに応じたレイアウト調整

## 5. 機能仕様

### 5.1 検索機能
- キーワード検索
- リアルタイム検索（デバウンス付き）
- 検索結果のハイライト表示
- 検索結果へのフォーカス移動

### 5.2 フィルター機能
- ノードタイプ別フィルタリング
- フィルター結果の動的表示

### 5.3 編集機能
- インラインテキスト編集
- 編集内容の即時反映
- キャンセル操作対応

### 5.4 URL管理
- 各ノードに最大5つのURLを設定可能
- URLにラベルと説明を付加
- 情報パネルでのURL一覧表示

### 5.5 画像表示機能
- 各ノードに1枚の参考画像を設定可能
- 画像URL、代替テキスト、キャプションをサポート
- 情報パネルでの画像表示
- ローカル画像と外部画像の両方に対応

### 5.6 URLプレビュー機能
- URLにカーソルを合わせると自動でプレビュー表示
- 0.5秒のホバーでプレビュー起動
- 対応形式：
  - Webページ（ファビコンとドメイン表示）
  - PDF（ファイル名表示）
  - 画像（サムネイル表示）
- プレビューからリンクを直接開くことも可能

## 6. パフォーマンス考慮事項

### 6.1 最適化
- 6階層対応の横長レイアウト
- ノードの動的な展開/折りたたみ
- 効率的なDOM操作
- イベントのデバウンス/スロットリング

### 6.2 ユーザビリティ
- 日本語テキストの適切な折り返し
- 読みやすいフォントサイズ
- 明確な色分けによる視覚的区別
- 直感的な操作性

## 7. セキュリティ考慮事項

### 7.1 クライアントサイド
- XSS対策（テキスト編集時のサニタイズ）
- 外部リンクのrel="noopener noreferrer"設定

## 8. 今後の拡張性

### 8.1 機能拡張の可能性
- データのインポート/エクスポート機能
- 複数言語対応
- 印刷対応
- データの永続化（バックエンド連携）
- コラボレーション機能

### 8.2 データ拡張
- 新しいノードタイプの追加
- メタデータの拡充
- タグ機能
- 時系列データ対応